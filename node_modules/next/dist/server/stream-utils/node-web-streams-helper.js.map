{"version":3,"sources":["../../../src/server/stream-utils/node-web-streams-helper.ts"],"names":["streamToBufferedResult","readableStreamTee","chainStreams","streamFromArray","streamToString","createBufferedTransformStream","createInsertedHTMLStream","renderToInitialStream","createDeferredSuffixStream","createInlineDataStream","createSuffixStream","createRootLayoutValidatorStream","continueFromInitialStream","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","renderResult","renderChunks","textDecoder","TextDecoder","writable","write","chunk","push","decodeText","end","destroy","pipe","join","readable","transformStream","TransformStream","transformStream2","writer","getWriter","writer2","reader","getReader","read","then","done","value","close","streams","promise","Promise","resolve","i","length","pipeTo","preventClose","strings","forEach","str","encodeText","stream","bufferedString","transform","v","pendingFlush","flushBuffer","controller","buffered","enqueue","flush","getServerInsertedHTML","insertedHTMLChunk","ReactDOMServer","element","streamOptions","getTracer","trace","AppRenderSpan","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","suffix","suffixFlushed","suffixFlushTask","res","dataStream","dataStreamFinished","dataStreamReader","err","error","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","nonNullable","JSON","stringify","tree","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","serverInsertedHTML","reduce","pipeThrough"],"mappings":"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"}